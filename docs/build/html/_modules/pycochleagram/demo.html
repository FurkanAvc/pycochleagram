

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pycochleagram.demo &mdash; pycochleagram  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/cochleagramIcon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="pycochleagram  documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pycochleagram
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readmeLink.html">pycochleagram readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycochleagram.html">pycochleagram package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pycochleagram</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pycochleagram.demo</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pycochleagram.demo</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">welch</span><span class="p">,</span> <span class="n">decimate</span>

<span class="kn">from</span> <span class="nn">pycochleagram</span> <span class="k">import</span> <span class="n">cochleagram</span> <span class="k">as</span> <span class="n">cgram</span>
<span class="kn">from</span> <span class="nn">pycochleagram</span> <span class="k">import</span> <span class="n">erbfilter</span> <span class="k">as</span> <span class="n">erb</span>
<span class="kn">from</span> <span class="nn">pycochleagram</span> <span class="k">import</span> <span class="n">utils</span>


<span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_if_display_exists</span><span class="p">():</span>
  <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
  <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">show</span>
<span class="k">else</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">matplotlib</span>
  <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
  <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
  <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">show</span>


<span class="c1">### Cochleagram Generation from Waveform ###</span>
<div class="viewcode-block" id="demo_human_cochleagram"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.demo_human_cochleagram">[docs]</a><span class="k">def</span> <span class="nf">demo_human_cochleagram</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Demo to generate the human cochleagrams, displaying various nonlinearity</span>
<span class="sd">  and downsampling options. If a signal is not provided, a tone synthesized</span>
<span class="sd">  with 40 harmonics and an f0=100 will be used.</span>

<span class="sd">  Args:</span>
<span class="sd">    signal (array, optional): Signal containing waveform data.</span>
<span class="sd">    sr (int, optional): Sampling rate of the input signal.</span>
<span class="sd">    n (int, optional): Number of filters to use in the filterbank.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># get a signal if one isn&#39;t provided</span>
  <span class="k">if</span> <span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">signal</span><span class="p">,</span> <span class="n">signal_params</span> <span class="o">=</span> <span class="n">make_harmonic_stack</span><span class="p">()</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;sr&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">sr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

  <span class="c1">### Demo Cochleagram Generation with Predefined Nonlinearities ###</span>
  <span class="c1"># no nonlinearity</span>
  <span class="n">coch</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
  <span class="c1"># convert to decibel</span>
  <span class="n">coch_log</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">)</span>
  <span class="c1"># 3/10 power compression</span>
  <span class="n">coch_pow</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal waveform&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">323</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal Frequency Content&#39;</span><span class="p">)</span>
  <span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sr</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency [Hz]&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PSD [V**2/Hz]&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram with no nonlinearity&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">coch</span><span class="p">),</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">324</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram with nonlinearity: &quot;log&quot;&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">coch_log</span><span class="p">),</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">326</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram with nonlinearity: &quot;power&quot;&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">coch_pow</span><span class="p">),</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

  <span class="c1">### Demo Cochleagram Generation with Downsampling ###</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="c1"># no downsampling</span>
  <span class="c1"># cochd = demo_human_cochleagram_helper(signal, sr, n, downsample=None)</span>
  <span class="c1"># predefined polyphase resampling with upsample factor = 10000, downsample factor = `sr`</span>
  <span class="n">cochd_poly</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
  <span class="c1"># custom downsampling function to use decimate with a downsampling factor of 2</span>
  <span class="n">custom_downsample_fx</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">decimate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span> <span class="n">zero_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">cochd_decimate</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="n">custom_downsample_fx</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal waveform&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal Frequency Content&#39;</span><span class="p">)</span>
  <span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sr</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency [Hz]&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PSD [V**2/Hz]&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram with 2x default</span><span class="se">\n</span><span class="s1">(polyphase) downsampling&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">cochd_poly</span><span class="p">),</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram with 2x custom</span><span class="se">\n</span><span class="s1">(decimate) downsampling&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">cochd_decimate</span><span class="p">),</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="demo_human_cochleagram_helper"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.demo_human_cochleagram_helper">[docs]</a><span class="k">def</span> <span class="nf">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sample_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Demo the cochleagram generation.</span>

<span class="sd">    signal (array): If a time-domain signal is provided, its</span>
<span class="sd">      cochleagram will be generated with some sensible parameters. If this is</span>
<span class="sd">      None, a synthesized tone (harmonic stack of the first 40 harmonics) will</span>
<span class="sd">      be used.</span>
<span class="sd">    sr: (int): If `signal` is not None, this is the sampling rate</span>
<span class="sd">      associated with the signal.</span>
<span class="sd">    n (int): number of filters to use.</span>
<span class="sd">    sample_factor (int): Determines the density (or &quot;overcompleteness&quot;) of the</span>
<span class="sd">      filterbank. Original MATLAB code supported 1, 2, 4.</span>
<span class="sd">    downsample({None, int, callable}, optional): Determines downsampling method to apply.</span>
<span class="sd">      If None, no downsampling will be applied. If this is an int, it will be</span>
<span class="sd">      interpreted as the upsampling factor in polyphase resampling</span>
<span class="sd">      (with `sr` as the downsampling factor). A custom downsampling function can</span>
<span class="sd">      be provided as a callable. The callable will be called on the subband</span>
<span class="sd">      envelopes.</span>
<span class="sd">    nonlinearity({None, &#39;db&#39;, &#39;power&#39;, callable}, optional): Determines</span>
<span class="sd">      nonlinearity method to apply. None applies no nonlinearity. &#39;db&#39; will</span>
<span class="sd">      convert output to decibels (truncated at -60). &#39;power&#39; will apply 3/10</span>
<span class="sd">      power compression.</span>

<span class="sd">    Returns:</span>
<span class="sd">      array:</span>
<span class="sd">        **cochleagram**: The cochleagram of the input signal, created with</span>
<span class="sd">          largely default parameters.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">human_coch</span> <span class="o">=</span> <span class="n">cgram</span><span class="o">.</span><span class="n">human_cochleagram</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">sample_factor</span><span class="o">=</span><span class="n">sample_factor</span><span class="p">,</span>
      <span class="n">downsample</span><span class="o">=</span><span class="n">downsample</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="n">nonlinearity</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">human_coch</span><span class="p">)</span>  <span class="c1"># the cochleagram is upside down (i.e., in image coordinates)</span>
  <span class="k">return</span> <span class="n">img</span></div>


<span class="c1">### Waveform Generation from Cochleagram (Inversion) ###</span>
<div class="viewcode-block" id="demo_invert_cochleagram"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.demo_invert_cochleagram">[docs]</a><span class="k">def</span> <span class="nf">demo_invert_cochleagram</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">playback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Demo that will generate a cochleagram from a signal, then invert this</span>
<span class="sd">  cochleagram to produce a waveform signal.</span>

<span class="sd">  Args:</span>
<span class="sd">    signal (array, optional): Signal containing waveform data.</span>
<span class="sd">    sr (int, optional): Sampling rate of the input signal.</span>
<span class="sd">    n (int, optional): Number of filters to use in the filterbank.</span>
<span class="sd">    playback (bool, optional): Determines if audio signals will be played</span>
<span class="sd">      (using pyaudio). If False, only plots will be created. If True, the</span>
<span class="sd">      original signal and inverted cochleagram signal will be played. NOTE:</span>
<span class="sd">      Be careful with the volume when using playback, things can get</span>
<span class="sd">      *very loud*.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># get a signal if one isn&#39;t provided</span>
  <span class="k">if</span> <span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">signal</span><span class="p">,</span> <span class="n">signal_params</span> <span class="o">=</span> <span class="n">make_harmonic_stack</span><span class="p">()</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;sr&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">low_lim</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;low_lim&#39;</span><span class="p">]</span>
    <span class="n">hi_lim</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;hi_lim&#39;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">sr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">low_lim</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># this is the default for cochleagram.human_cochleagram</span>
    <span class="n">hi_lim</span> <span class="o">=</span> <span class="mi">20000</span>  <span class="c1"># this is the default for cochleagram.human_cochleagram</span>

  <span class="c1"># generate a cochleagram from the signal</span>
  <span class="n">sample_factor</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># this is the default for cochleagram.human_cochleagram</span>
  <span class="n">coch</span> <span class="o">=</span> <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sample_factor</span><span class="o">=</span><span class="n">sample_factor</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generated cochleagram with shape: &#39;</span><span class="p">,</span> <span class="n">coch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

  <span class="c1"># invert the cochleagram to get a signal</span>
  <span class="n">coch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">coch</span><span class="p">)</span>  <span class="c1"># the ouput of demo_human_cochleagram_helper is flipped</span>
  <span class="n">inv_coch_sig</span><span class="p">,</span> <span class="n">inv_coch</span> <span class="o">=</span> <span class="n">cgram</span><span class="o">.</span><span class="n">invert_cochleagram</span><span class="p">(</span><span class="n">coch</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">low_lim</span><span class="p">,</span> <span class="n">hi_lim</span><span class="p">,</span> <span class="n">sample_factor</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generated inverted cochleagram&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original signal shape: </span><span class="si">%s</span><span class="s1">, Inverted cochleagram signal shape: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">inv_coch_sig</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram of original signal&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">coch</span><span class="p">,</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># this signal is already flipped</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cochleagram of inverted signal&#39;</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">cochshow</span><span class="p">(</span><span class="n">inv_coch</span><span class="p">,</span> <span class="n">interact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># this signal needs to be flipped</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;filter #&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">playback</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;playing original signal...&#39;</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">play_array</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">pyaudio_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">sr</span><span class="p">},</span> <span class="n">ignore_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;playing inverted cochleagram signal...&#39;</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">play_array</span><span class="p">(</span><span class="n">inv_coch_sig</span><span class="p">,</span> <span class="n">pyaudio_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">sr</span><span class="p">},</span> <span class="n">ignore_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="demo_playback"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.demo_playback">[docs]</a><span class="k">def</span> <span class="nf">demo_playback</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">ignore_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Demo audio playback with pyaudio.</span>

<span class="sd">  Args:</span>
<span class="sd">    signal (array, optional): Signal containing waveform data.</span>
<span class="sd">    sr (int, optional): Sampling rate of the input signal.</span>
<span class="sd">    ignore_warning (bool, optional): Determines if audio signals will be played</span>
<span class="sd">      (using pyaudio). NOTE: Be careful with the volume when using playback,</span>
<span class="sd">      things can get *very loud*.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># get a signal if one isn&#39;t provided</span>
  <span class="k">if</span> <span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">signal</span><span class="p">,</span> <span class="n">signal_params</span> <span class="o">=</span> <span class="n">make_harmonic_stack</span><span class="p">()</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">signal_params</span><span class="p">[</span><span class="s1">&#39;sr&#39;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">sr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

  <span class="c1"># audio playback</span>
  <span class="n">pyaudio_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_channels</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
                  <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">sr</span><span class="p">,</span>
                  <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;output_device_index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="n">utils</span><span class="o">.</span><span class="n">play_array</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">pyaudio_params</span><span class="o">=</span><span class="n">pyaudio_params</span><span class="p">,</span> <span class="n">ignore_warning</span><span class="o">=</span><span class="n">ignore_warning</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_harmonic_stack"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.make_harmonic_stack">[docs]</a><span class="k">def</span> <span class="nf">make_harmonic_stack</span><span class="p">(</span><span class="n">f0</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_harm</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="mf">0.25001</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">low_lim</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">hi_lim</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Synthesize a tone created with a stack of harmonics.</span>

<span class="sd">  Args:</span>
<span class="sd">    f0 (int, optional): Fundamental frequency.</span>
<span class="sd">    n_harm (int, optional): Number of harmonics to include.</span>
<span class="sd">    dur (float, optional): Duration, in milliseconds. Note, the default value</span>
<span class="sd">      was chosen to create a signal length that is compatible with the</span>
<span class="sd">      predefined downsampling method.</span>
<span class="sd">    sr (int, optional): Sampling rate.</span>
<span class="sd">    low_lim (int, optional): Lower limit for filterbank.</span>
<span class="sd">    hi_lim (int, optional): Upper limit for filerbank.</span>
<span class="sd">    n (None, optional): Number of filters in filterbank.</span>

<span class="sd">  Returns:</span>
<span class="sd">    tuple:</span>
<span class="sd">      **signal** (array): Synthesized tone.</span>
<span class="sd">      **signal_params** (dict): A dictionary containing all of the parameters</span>
<span class="sd">        used to synthesize the tone.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># i don&#39;t know where this came from, but choose a number of filters</span>
  <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">erb</span><span class="o">.</span><span class="n">freq2erb</span><span class="p">(</span><span class="n">hi_lim</span><span class="p">)</span> <span class="o">-</span> <span class="n">erb</span><span class="o">.</span><span class="n">freq2erb</span><span class="p">(</span><span class="n">low_lim</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># synthesize tone from harmonic stack</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sr</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sr</span><span class="p">)</span>
  <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_harm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">signal</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># zero-phase</span>

  <span class="c1"># store all the params in a dictionary</span>
  <span class="n">signal_params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;f0&#39;</span><span class="p">:</span> <span class="n">f0</span><span class="p">,</span>
      <span class="s1">&#39;n_harm&#39;</span><span class="p">:</span> <span class="n">n_harm</span><span class="p">,</span>
      <span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="n">dur</span><span class="p">,</span>
      <span class="s1">&#39;sr&#39;</span><span class="p">:</span> <span class="n">sr</span><span class="p">,</span>
      <span class="s1">&#39;low_lim&#39;</span><span class="p">:</span> <span class="n">low_lim</span><span class="p">,</span>
      <span class="s1">&#39;hi_lim&#39;</span><span class="p">:</span> <span class="n">hi_lim</span><span class="p">,</span>
      <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">signal</span><span class="p">,</span> <span class="n">signal_params</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../pycochleagram.html#pycochleagram.demo.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">ignore_playback_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rand_sound&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Run all demo functions.</span>

<span class="sd">  Args:</span>
<span class="sd">    ignore_playback_warning (bool, optional): To use audio playback, you must</span>
<span class="sd">      acknowledge that things can get *very loud* by setting</span>
<span class="sd">      `ignore_playback_warning` to True.</span>
<span class="sd">    mode ({&#39;rand_sound&#39;, other}): Set the mode for the demo. If this is</span>
<span class="sd">      &#39;rand_sound&#39;, a sound from the demo_stim/ directory will be chosen</span>
<span class="sd">      at random and used for the demos. If this is anything else, a harmonic</span>
<span class="sd">      stack of 40 harmonics and an f0=100Hz will be generated and used.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
  <span class="n">DEMO_PATH</span> <span class="o">=</span> <span class="s1">&#39;/Users/raygon/Desktop/mdLab/projects/public/pycochleagram/pycochleagram/demo_stim/&#39;</span>
  <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;rand_sound&#39;</span><span class="p">:</span>
    <span class="n">rfn</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DEMO_PATH</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">DEMO_PATH</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.wav&#39;</span><span class="p">)])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">DEMO_PATH</span><span class="p">))</span>
    <span class="c1"># rfn = [os.path.join(DEMO_PATH, f)for f in os.listdir(DEMO_PATH)][1]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running demo with sound file: </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">rfn</span><span class="p">)</span>
    <span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">wav_to_array</span><span class="p">(</span><span class="n">rfn</span><span class="p">)</span>
    <span class="n">demo_n</span> <span class="o">=</span> <span class="mi">38</span>  <span class="c1"># default filter for low_lim=50 hi_lim=20000</span>
  <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;batch&#39;</span><span class="p">:</span>
    <span class="n">demo_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;demo_stim/wavs_speech_n10_2s_16k.npy&#39;</span><span class="p">)</span>
    <span class="n">demo_sr</span> <span class="o">=</span> <span class="mi">16000</span>
    <span class="n">demo_n</span> <span class="o">=</span> <span class="mi">38</span>  <span class="c1"># default filter for low_lim=50 hi_lim=20000</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">demo_n</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Improved Batch --&gt; </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">s per coch&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="n">total_time</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span>
  <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;naive_batch&#39;</span><span class="p">:</span>
    <span class="n">demo_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;demo_stim/wavs_speech_n10_2s_16k.npy&#39;</span><span class="p">)</span>
    <span class="n">demo_sr</span> <span class="o">=</span> <span class="mi">16000</span>
    <span class="n">demo_n</span> <span class="o">=</span> <span class="mi">38</span>  <span class="c1"># default filter for low_lim=50 hi_lim=20000</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">demo_stim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="c1"># print(&#39;%s/%s&#39; % (i+1, demo_stim.shape[0]))</span>
      <span class="n">temp_signal</span> <span class="o">=</span> <span class="n">demo_stim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">demo_human_cochleagram_helper</span><span class="p">(</span><span class="n">temp_signal</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">demo_n</span><span class="p">,</span> <span class="n">downsample</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Naive Batch --&gt; </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">s per coch&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="n">total_time</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">demo_n</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">### DEMO: COCHLEAGRAM GENERATION ###&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;====================================&#39;</span><span class="p">)</span>
  <span class="n">demo_human_cochleagram</span><span class="p">(</span><span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">demo_n</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">### DEMO: AUDIO PLAYBACK ###&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;============================&#39;</span><span class="p">)</span>
  <span class="n">demo_playback</span><span class="p">(</span><span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">ignore_warning</span><span class="o">=</span><span class="n">ignore_playback_warning</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">### DEMO: COCHLEAGRAM INVERSION ###</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===================================&#39;</span><span class="p">)</span>
  <span class="n">demo_invert_cochleagram</span><span class="p">(</span><span class="n">demo_stim</span><span class="p">,</span> <span class="n">demo_sr</span><span class="p">,</span> <span class="n">demo_n</span><span class="p">,</span> <span class="n">playback</span><span class="o">=</span><span class="n">ignore_playback_warning</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--playback&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If True, will playback audio signals as part of demo. NOTE: This can get LOUD.&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--mode&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;rand_sound&#39;</span><span class="p">,</span>
      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Determines what type of signals to use for the demo. Can be &quot;harm_stack&quot; for a synthesized tone, or &quot;rand_sound&quot; &#39;</span><span class="o">+</span>
      <span class="s1">&#39;for a random soundfile in the demo_stim/ directory. Defaults to &quot;rand_sound&quot;.&#39;</span><span class="p">)</span>
  <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">playback</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">NOTE: Audio playback has been disabled for this demo. Enable with the flag -p. NOTE: This can get LOUD.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">playback</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ray Gonzalez.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>